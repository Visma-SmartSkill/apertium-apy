name: "Main build"

# This workflow invokes the standard SmartSkill build and deploy workflows.

on:
  push:
    branches: ["main", "master"]
  pull_request:
  workflow_dispatch:

jobs:
  build-apertium-apy:
    name: Build VssTranslate
    uses: ./.github/workflows/buildcontainer.yml
    permissions:
      contents: write
      packages: write
      pull-requests: write
    with:
      service-name: ${{ vars.SERVICE_NAME }}
      trigger-release: false
    secrets:
      CREATERELEASETOKEN: ${{ secrets.CREATERELEASETOKEN }}

  tag:
    name: Tag release
    needs: build-apertium-apy
    runs-on: ubuntu-latest

    steps:
      - name: üè∑Ô∏è Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v${{ needs.build-apertium-apy.outputs.version }}
          token: ${{ secrets.CREATERELEASETOKEN }} # A PAT is required to trigger the deployment workflow (GitHub's way of preventing recursive workflows)
          prerelease: ${{ github.base_ref != '' && true || false }}
          target_commitish: ${{ github.sha }}